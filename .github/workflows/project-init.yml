name: ðŸš€ Project Initialization Helper

on:
  workflow_dispatch:
    inputs:
      components:
        description: 'Components to initialize (comma-separated: backend,frontend,contracts,agents,docs)'
        required: true
        default: 'backend,frontend,contracts'
      typescript:
        description: 'Use TypeScript?'
        required: true
        default: 'true'
        type: boolean

jobs:
  initialize-project:
    runs-on: ubuntu-latest
        permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: ${{ hashFiles('package-lock.json') != '' && 'npm' || '' }}
      
      - name: Initialize Backend
        if: contains(github.event.inputs.components, 'backend')
        run: |
          mkdir -p backend/src backend/tests
          cd backend
          
          # Create package.json
          cat > package.json << 'EOF'
          {
            "name": "nwu-backend",
            "version": "1.0.0",
            "description": "NWU Protocol Backend",
            "main": "src/index.js",
            "scripts": {
              "start": "node src/index.js",
              "dev": "nodemon src/index.js",
              "test": "jest",
              "lint": "eslint ."
            },
            "dependencies": {
              "express": "^4.18.0",
              "mongoose": "^8.0.0",
              "redis": "^4.6.0",
              "amqplib": "^0.10.0"
            },
            "devDependencies": {
              "nodemon": "^3.0.0",
              "jest": "^29.7.0",
              "eslint": "^8.0.0"
            }
          }
          EOF
          
          # Create main entry point
          cat > src/index.js << 'EOF'
          const express = require('express');
          const app = express();
          const PORT = process.env.PORT || 3000;
          
          app.get('/health', (req, res) => {
            res.json({ status: 'healthy', timestamp: new Date() });
          });
          
          app.listen(PORT, () => {
            console.log(`ðŸš€ NWU Backend running on port ${PORT}`);
          });
          EOF
          
          # Create README
          cat > README.md << 'EOF'
          # NWU Protocol Backend
          
          ## Setup
          ```bash
          npm install
          npm run dev
          ```
          
          ## Test
          ```bash
          npm test
          ```
          EOF
          
          echo "âœ… Backend initialized!"
      
      - name: Initialize Frontend
        if: contains(github.event.inputs.components, 'frontend')
        run: |
          npx create-next-app@latest frontend --typescript --tailwind --app --no-src-dir --import-alias "@/*" --use-npm --yes
          echo "âœ… Frontend initialized with Next.js 14!"
      
      - name: Initialize Smart Contracts
        if: contains(github.event.inputs.components, 'contracts')
        run: |
          mkdir -p contracts/contracts contracts/scripts contracts/test
          cd contracts
          npm init -y
          npm install --save-dev hardhat @nomicfoundation/hardhat-toolbox
          npx hardhat init --yes
          
          cat > contracts/NWUToken.sol << 'EOF'
          // SPDX-License-Identifier: MIT
          pragma solidity ^0.8.20;
          
          import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
          import "@openzeppelin/contracts/access/Ownable.sol";
          
          contract NWUToken is ERC20, Ownable {
              constructor() ERC20("NWU Token", "NWU") Ownable(msg.sender) {
                  _mint(msg.sender, 1000000 * 10 ** decimals());
              }
              
              function mint(address to, uint256 amount) public onlyOwner {
                  _mint(to, amount);
              }
          }
          EOF
          
          echo "âœ… Smart contracts initialized with Hardhat!"
      
      - name: Initialize AI Agents
        if: contains(github.event.inputs.components, 'agents')
        run: |
          mkdir -p agents/src agents/tests
          cd agents
          
          cat > requirements.txt << 'EOF'
          langchain==0.1.0
          openai==1.10.0
          pika==1.3.2
          python-dotenv==1.0.0
          EOF
          
          cat > src/agent_alpha.py << 'EOF'
          import os
          from langchain.chat_models import ChatOpenAI
          
          class AgentAlpha:
              def __init__(self):
                  self.llm = ChatOpenAI(model="gpt-4")
              
              def verify_contribution(self, content):
                  """Verify code quality and originality"""
                  # TODO: Implement verification logic
                  return {"score": 0.85, "approved": True}
          
          if __name__ == "__main__":
              agent = AgentAlpha()
              print("ðŸ¤– Agent Alpha initialized!")
          EOF
          
          echo "âœ… AI Agents initialized!"
      
      - name: Initialize Documentation
        if: contains(github.event.inputs.components, 'docs')
        run: |
          mkdir -p docs
          
          cat > docs/README.md << 'EOF'
          # NWU Protocol Documentation
          
          ## Architecture
          
          The NWU Protocol consists of:
          - **Backend**: Node.js API server
          - **Frontend**: Next.js 14 application
          - **Smart Contracts**: Solidity contracts on Ethereum
          - **AI Agents**: Python-based verification system
          
          ## Getting Started
          
          See individual component READMEs for setup instructions.
          EOF
          
          echo "âœ… Documentation initialized!"
      
      - name: Create Docker Compose
        run: |
          cat > docker-compose.yml << 'EOF'
          version: '3.8'
          
          services:
            mongodb:
              image: mongo:latest
              ports:
                - "27017:27017"
              volumes:
                - mongo-data:/data/db
            
            redis:
              image: redis:latest
              ports:
                - "6379:6379"
            
            rabbitmq:
              image: rabbitmq:3-management
              ports:
                - "5672:5672"
                - "15672:15672"
          
          volumes:
            mongo-data:
          EOF
          
          echo "âœ… Docker Compose created!"
      
      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add .
          git commit -m "ðŸš€ Initialize project structure
          
          Components: ${{ github.event.inputs.components }}
          TypeScript: ${{ github.event.inputs.typescript }}
          " || echo "No changes to commit"
          git push
      
      - name: Summary
        run: |
          echo "ðŸŽ‰ Project initialization complete!"
          echo "Initialized: ${{ github.event.inputs.components }}"
          echo "TypeScript: ${{ github.event.inputs.typescript }}"
          echo ""
          echo "Next steps:"
          echo "1. Pull the changes: git pull"
          echo "2. Install dependencies in each component"
          echo "3. Start Docker services: docker-compose up -d"
          echo "4. Start developing! ðŸš€"
